import telegram
from telegram.ext import Updater, MessageHandler, Filters
import openai

# Telegram Bot API Token
telegram_token = '6873402481:AAHh-koLIk2D3weddatTzdaoIpeSrc0NUbU'

# OpenAI API Token
openai_token = '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'
openai_chat_model = 'gpt-3.5-turbo'

# Create a Telegram bot instance
bot = telegram.Bot(token=telegram_token)

# Create an OpenAI Chat instance
openai.ChatCompletion.create(engine=openai_chat_model)

# Handler function to process user messages
def handle_message(update, context):
    message = update.message.text
    
    # Send user message to OpenAI Chat API
    response = openai.ChatCompletion.create(
        model=openai_chat_model,
        messages=[
            {"role": "system", "content": "You are a helpful assistant."},
            {"role": "user", "content": message}
        ]
    )
    
    # Get the assistant's reply from the response
    reply = response.choices[0].message.content
    
    # Send the assistant's reply back to the user on Telegram
    context.bot.send_message(chat_id=update.effective_chat.id, text=reply)

# Create an Updater and attach the message handler
updater = Updater(token=telegram_token, use_context=True)
dispatcher = updater.dispatcher
dispatcher.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))

# Start the bot
updater.start_polling()
